---
title: "Figure 3 Community structure"
author: "Venus"
date: "June 10, 2017"
output: html_document
---

## 1) Soil community structure and diversity 

Question: How does Rpf treatment affect soil diversity and community composition?

## 2) Set up work environment

```{r}
# Setup work enviroment 
rm(list = ls())
setwd("C:/Users/Venus/GitHub/BrassicaRpf/analysis")
source("C:/Users/Venus/GitHub/BrassicaRpf/analysis/MothurTools.R")
require("vegan")
require("gplots")
se <- function(x, ...){sd(x, na.rm = TRUE)/sqrt(length(na.omit(x)))}
```

## 3) Describe and load data set

Brassica.design.txt : 
Brassica.bac.final.shared: A sample by species matrix of bacterial OTUs from Illumina MiSeq sequencing run. 
Brassica.taxon : 

```{r}
# Define Inputs
# Design = general design file for experiment
# shared = OTU table from mothur with sequence similarity clustering
design <- "C:/Users/Venus/GitHub/GPCA/data/GPCA.design.txt"
shared <- "C:/Users/Venus/GitHub/BrassicaRpf/mothur/output/Brassica.bac.final.shared"
taxon <- "C:/Users/Venus/GitHub/GPCA/data/GPCA.1.bac.final.0.03.taxonomy"

```

## 4) Read otu using mothur tool code

```{r}
# Import Design
#design <- read.delim(design, header=T, row.names=1)

# Import Shared Files
OTUs <- read.otu(shared = shared, cutoff = "0.16")         # 97% Similarity

# Import Taxonomy
#OTU.tax <- read.tax(taxonomy = taxon, format = "rdp")

# Remove OTUs with less than two occurances across all sites
OTUs <- OTUs[, which(colSums(OTUs) >= 2)]
```

## 5) Determine coverage of sequences

```{r}
# Coverage Stats
coverage <- rowSums(OTUs)
summary(coverage)

# Make Presence Absence Matrices
OTUsPA <- (OTUs > 0) * 1

rich <- rowSums(OTUsPA)
summary(rich)

# Make Relative Abundence Matrices
OTUsREL <- OTUs
for(i in 1:dim(OTUs)[1]){
  OTUsREL[i,]<- OTUs[i,]/sum(OTUs[i,])
}

```










